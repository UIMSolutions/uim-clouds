Alles klar, Ozan â€” du willst also ein Multiâ€‘Stageâ€‘Image fÃ¼r GTKDâ€‘Entwicklung + Flatpakâ€‘Builds.  
Das ist genau der richtige Weg, denn Multiâ€‘Stageâ€‘Builds halten dein finales Image klein, sauber und reproduzierbar, wÃ¤hrend du im ersten Stage eine komplette Buildâ€‘Umgebung hast.

Ich gebe dir jetzt ein professionelles Multiâ€‘Stageâ€‘Dockerfile, das perfekt zu deinem Workflow passt:

- Stage 1: VollstÃ¤ndige Buildâ€‘Umgebung  
  - DMD + DUB  
  - GTKâ€‘Devâ€‘Libraries  
  - Flatpak + Flatpak Builder  
  - GNOME SDK  
  - GTKD wird gebaut  
  - Deine App wird kompiliert  

- Stage 2: Minimalâ€‘Runtime  
  - Nur GTKâ€‘Runtime  
  - Dein kompiliertes Binary  
  - Perfekt fÃ¼r Podman Desktop oder Deployment  

---

ðŸ§± Multiâ€‘Stage Dockerfile fÃ¼r GTKD + Flatpak

`Dockerfile

#########################

Stage 1: Build Environment

#########################
FROM ubuntu:24.04 AS build-env

Basis-Tools
RUN apt-get update && apt-get install -y \
    wget git gcc g++ make pkg-config ca-certificates curl \
    # GTK3 Development
    libgtk-3-dev libglib2.0-dev libpango1.0-dev libcairo2-dev \
    libgdk-pixbuf-2.0-dev libatk1.0-dev \
    # Flatpak + Builder
    flatpak flatpak-builder \
    && rm -rf /var/lib/apt/lists/*

GNOME SDK installieren
RUN flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo && \
    flatpak install -y flathub org.gnome.Sdk//46 && \
    flatpak install -y flathub org.gnome.Platform//46

DMD + DUB installieren
RUN wget https://dlang.org/install.sh -O install.sh && \
    bash install.sh dmd && rm install.sh

ENV PATH="/root/dlang/dmd-*/bin:${PATH}"

GTKD vorbereiten
RUN dub fetch gtkd && dub build gtkd

Projekt kopieren
WORKDIR /build
COPY . .

App bauen (Release)
RUN dub build --build=release

#########################

Stage 2: Runtime Image

#########################
FROM ubuntu:24.04 AS runtime

Nur GTK Runtime installieren
RUN apt-get update && apt-get install -y \
    libgtk-3-0 libglib2.0-0 libpango-1.0-0 libcairo2 \
    libgdk-pixbuf-2.0-0 libatk1.0-0 \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

Binary aus Stage 1 kopieren
COPY --from=build-env /build/myapp .

CMD ["./myapp"]
`

---

ðŸš€ Build

`bash
podman build -t gtkd-flatpak-multi .
`

---

ðŸ§ª Run

`bash
podman run --rm -it gtkd-flatpak-multi
`

---

ðŸ§© Warum dieses Multiâ€‘Stageâ€‘Image perfekt ist

| Stage | Inhalt | Vorteil |
|-------|--------|---------|
| build-env | GTKâ€‘Dev, Flatpak, GNOME SDK, DMD, GTKD | VollstÃ¤ndige Buildâ€‘Umgebung |
| runtime | Nur GTKâ€‘Runtime + Binary | Sehr kleines Image, ideal fÃ¼r Deployment |

Du bekommst:

- saubere Trennung von Build und Runtime  
- kleines finales Image  
- Flatpakâ€‘kompatible Builds  
- GTKDâ€‘optimierte Entwicklungsumgebung  

---

ðŸ”¥ Wenn du willst, kann ich dir sofort erstellen:

ðŸ‘‰ Ein vollstÃ¤ndiges GTKDâ€‘Flatpakâ€‘Projektâ€‘Template
mit Manifest, Icons, Desktopâ€‘File, Buildâ€‘Script.

ðŸ‘‰ Ein Multiâ€‘Stageâ€‘Build, das automatisch ein .flatpak Bundle erzeugt.

ðŸ‘‰ Eine Variante mit LDC fÃ¼r bessere Performance.

Sag mir einfach, wie du dein Setup weiter verfeinern mÃ¶chtest.